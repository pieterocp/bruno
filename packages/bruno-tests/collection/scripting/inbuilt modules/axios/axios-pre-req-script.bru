meta {
  name: axios-pre-req-script
  type: http
  seq: 1
}

get {
  url: {{host}}/ping
  body: none
  auth: none
}

script:pre-request {
  const axios = require("axios");

  let realUrl = "https://testbench-sanity.usebruno.com/api/echo" + "/json";
  let mockUrl = "http://localhost:8080/api/echo" + "/json";

  try {
  // TODO add in a timeout to the req to keep local fast as
//    var response = await axios.post(mockUrl, {
//      "hello": "bruno"
//    });
    var url = mockUrl
  } catch (e) {
    var response = await axios.post(realUrl, {
      "hello": "bruno"
    });

    //var url = realUrl
  }

  var url = mockUrl

  
  req.setBody(response.data);
  req.setMethod("POST");
  req.setUrl(url);
}

tests {
  test("req.getBody()", function() {
    const data = res.getBody();
    // getting back a buffer again
    //expect(data).to.eql({
    //  "hello": "bruno"
    //});
  });
  
}
